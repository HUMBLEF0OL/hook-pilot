#!/bin/sh

echo -e "\033[1müßπ  Running Code Formatter...\033[0m"

# Check if Prettier is installed using npx
if ! npx prettier --version > /dev/null 2>&1; then
  echo -e "\033[1;31m‚ùå  Prettier not found! Please install it (e.g., 'npm install prettier --save-dev').\033[0m"
  exit 1
fi

# Remove spaces around = in variable assignment
files_to_format=$(get_hook_config "pre-commit" "files_to_format" "**/*.{js,jsx,ts,tsx,css,scss,md}")

# Check if there are any files to format
if ! find . -path "$files_to_format" -type f 2>/dev/null | grep -q .; then
    echo -e "\033[1;33m‚ö†Ô∏è  No files found matching the pattern. Skipping formatting.\033[0m"
    exit 0
fi

# Format code
npx prettier --write "$files_to_format"
if [ $? -ne 0 ]; then
  echo -e "\033[1;31m‚ùå  Formatting failed. Please check for errors.\033[0m"
  exit 1
fi

echo -e "\033[1;32m‚úÖ  Code formatted successfully.\033[0m"